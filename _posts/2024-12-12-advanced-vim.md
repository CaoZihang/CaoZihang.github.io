---
layout:       post
title:        "Advanced Vim"
author:       "Cao Zihang"
header-style: text
catalog:      true
status:		  "working"
tags:
    - 日常工具
---
# Practical Vim Notes

## `.`命令

上一次修改可以指代很多东西，修改的范围不仅仅是字符，还可以是整行，甚至是整个文件。

`>G`命令会增加从当前行到文档末尾处的缩进层级。`.`命令会对当前行重新执行`>G`命令。

进入插入模式 (`i`)也会形成一次修改，Vim会记录直到返回普通模式`<Esc>`的所有按键命令。在这样的修改后，使用`.`命令会重新执行所有按键操作。

在插入模式中，使用了上下左右方向键，会产生新的撤销块，等价于`<Esc>`+移动后重新`i`。

> `.`命令可以视作一个微型的宏。

`*`命令会查找当前光标下的单次。

**`.`命令最佳范式**
使用一次按键移动，另一次按键执行。

## 普通模式

`[count]<Ctrl-a>`：对当前光标之上或之后的数值添加`[count]`。

`[count]<Ctrl-x>`：对当前光标之上或之后的数值减少`[count]`。

0开头的数字会被Vim认为八进制。

`l`字符、`aw`单词、`ap`段落；与`d`结合删除，与`g~`/`gu`/`gU`结合转换大小写。

`>`增加缩进，`<`减少缩进，`=`自动缩进。

## 插入模式

插入模式下，`<ctrl-w>`删除前一个单词，`<ctrl-u>`删除至行首。

### 插入-普通模式

在插入模式中，使用`<Ctrl-o>`可暂时进入普通模式，执行一次命令后回到插入模式。

例如：`<Ctrl-o>zz`使当前行滚动到屏幕中心。

### 插入模式下使用寄存器

`<Ctrl-r>{register}`

常用：上次复制内容`<Ctrl-r>0`

其他特殊寄存器：
- `"`未命名寄存器（上次复制或删除）
- `%`当前文件名
- `#`上次打开的文件名
- `+`系统剪贴板
- `/`上次搜索内容
- `:`上次执行的命令

`<Ctrl-r>{register}`对于大量文本会出现延迟，也可能出现不必要的换行或额外缩进。

(不好用) `<Ctrl-r><Ctrl-p>{register}`按原义插入寄存器内文本，并修正不必要的缩进。

#### 表达式寄存器

`<Ctrl-r>=`访问表达式寄存器，可以在其中进行运算，回车键将结果插入到光标处。

## 可视模式
- `<Ctrl-v>`激活面相列块的可视模式
- `gv`重新选择上次高亮选区
- `o`切换活动端点

可视化模式，特别是块模式下，擅长处理表格等数据。

`<Ctrl-v>`可以同时在多行进行编辑。

`Vr-`将整行替换为等长的-。

> `<Ctrl-v>`多行编辑时，插入操作只会在顶行显示，但实际会修改所有行。

`$`可以打破`<Ctrl-v>`方形限制。

> 可视模式下，`i`和`a`会被视作一个文本对象的组成部分，不会进入插入模式。

## 命令行模式

- `:[range]join`连接指定范围内的行
- `:[range]normal {commands}`对范围内每一行执行普通模式命令
- `:[range]s(ubstitute)/pattern/replacement/[flags]`对范围内每一行执行替换
- `:[range]global/{pattern}/[cmd]`在指定范围内匹配的所有行，在其上执行命令行命令

命令行中，`.`当前行，`$`最后一行，`^`第一行，`%`所有行。

### 使用模式指定范围
例如：`:/<html>/,/<\/html>/[command]`处理标签内所有行。
